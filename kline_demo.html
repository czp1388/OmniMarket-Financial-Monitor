<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>寰宇多市场金融监控系统 - K线图演示</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.5em;
            margin: 0;
            background: linear-gradient(45deg, #00ff88, #00ccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .chart-container {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            height: 500px;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .control-group {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
        }
        select, button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: none;
            border-radius: 5px;
            background: #2a2a2a;
            color: white;
            font-size: 14px;
        }
        button {
            background: linear-gradient(45deg, #00ff88, #00ccff);
            color: #1a1a1a;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        .market-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .info-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .info-value {
            font-size: 1.5em;
            font-weight: bold;
            margin: 5px 0;
        }
        .positive { color: #00ff88; }
        .negative { color: #ff4444; }
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-top: 20px;
        }
        .status {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #00ff88;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>寰宇多市场金融监控系统</h1>
            <p>实时K线图表演示 - 支持多市场多周期监控</p>
        </div>

        <div class="market-info">
            <div class="info-card">
                <div>BTC/USDT</div>
                <div class="info-value positive">$42,567.89</div>
                <div>+2.34%</div>
            </div>
            <div class="info-card">
                <div>ETH/USDT</div>
                <div class="info-value positive">$2,345.67</div>
                <div>+1.23%</div>
            </div>
            <div class="info-card">
                <div>AAPL</div>
                <div class="info-value negative">$182.45</div>
                <div>-0.56%</div>
            </div>
            <div class="info-card">
                <div>USD/CNY</div>
                <div class="info-value">7.1987</div>
                <div>+0.12%</div>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>市场选择:</label>
                <select id="marketSelect">
                    <option value="crypto">加密货币 (BTC/USDT)</option>
                    <option value="stock">股票 (AAPL)</option>
                    <option value="forex">外汇 (USD/CNY)</option>
                    <option value="futures">期货</option>
                </select>
            </div>
            <div class="control-group">
                <label>时间周期:</label>
                <select id="timeframeSelect">
                    <option value="1m">1分钟</option>
                    <option value="5m">5分钟</option>
                    <option value="15m">15分钟</option>
                    <option value="1h" selected>1小时</option>
                    <option value="4h">4小时</option>
                    <option value="1d">日线</option>
                </select>
            </div>
            <div class="control-group">
                <label>技术指标:</label>
                <select id="indicatorSelect">
                    <option value="none">无指标</option>
                    <option value="sma">简单移动平均线</option>
                    <option value="ema">指数移动平均线</option>
                    <option value="macd">MACD</option>
                    <option value="rsi">RSI</option>
                    <option value="bollinger">布林带</option>
                </select>
            </div>
            <div class="control-group">
                <label>操作:</label>
                <button onclick="addRandomData()">模拟新数据</button>
                <button onclick="resetChart()">重置图表</button>
            </div>
        </div>

        <div id="chart" class="chart-container"></div>

        <div class="status-bar">
            <div class="status">
                <div class="status-dot"></div>
                <span>实时数据连接正常</span>
            </div>
            <div>最后更新: <span id="lastUpdate">刚刚</span></div>
        </div>
    </div>

    <script>
        // 初始化图表
        const chart = LightweightCharts.createChart(document.getElementById('chart'), {
            width: document.getElementById('chart').clientWidth,
            height: 450,
            layout: {
                background: { color: '#1a1a1a' },
                textColor: '#d1d4dc',
            },
            grid: {
                vertLines: { color: '#2b2b43' },
                horzLines: { color: '#2b2b43' },
            },
            crosshair: {
                mode: LightweightCharts.CrosshairMode.Normal,
            },
            rightPriceScale: {
                borderColor: '#2b2b43',
            },
            timeScale: {
                borderColor: '#2b2b43',
                timeVisible: true,
                secondsVisible: false,
            },
        });

        const candleSeries = chart.addCandlestickSeries({
            upColor: '#00ff88',
            downColor: '#ff4444',
            borderDownColor: '#ff4444',
            borderUpColor: '#00ff88',
            wickDownColor: '#ff4444',
            wickUpColor: '#00ff88',
        });

        // 生成模拟K线数据
        function generateSampleData(count = 200) {
            const data = [];
            let time = new Date();
            time.setHours(0, 0, 0, 0);
            time.setDate(time.getDate() - count);
            
            let price = 42000; // 初始价格
            
            for (let i = 0; i < count; ++i) {
                time.setDate(time.getDate() + 1);
                
                const volatility = 0.02; // 2% 波动率
                const changePercent = 2 * volatility * Math.random() - volatility;
                const change = price * changePercent;
                
                const open = price;
                const close = price + change;
                const high = Math.max(open, close) + Math.abs(change) * Math.random();
                const low = Math.min(open, close) - Math.abs(change) * Math.random();
                const volume = Math.random() * 1000 + 500;
                
                data.push({
                    time: time.getTime() / 1000,
                    open: open,
                    high: high,
                    low: low,
                    close: close,
                    volume: volume,
                });
                
                price = close;
            }
            
            return data;
        }

        // 初始化数据
        const initialData = generateSampleData();
        candleSeries.setData(initialData);

        // 添加移动平均线
        const smaSeries = chart.addLineSeries({
            color: '#2962FF',
            lineWidth: 2,
            title: '20周期SMA',
        });

        function calculateSMA(data, period) {
            const result = [];
            for (let i = period - 1; i < data.length; i++) {
                let sum = 0;
                for (let j = 0; j < period; j++) {
                    sum += data[i - j].close;
                }
                result.push({
                    time: data[i].time,
                    value: sum / period,
                });
            }
            return result;
        }

        const smaData = calculateSMA(initialData, 20);
        smaSeries.setData(smaData);

        // 添加随机数据函数
        function addRandomData() {
            const lastData = initialData[initialData.length - 1];
            const time = lastData.time + 86400; // 增加一天
            
            const volatility = 0.015;
            const changePercent = 2 * volatility * Math.random() - volatility;
            const change = lastData.close * changePercent;
            
            const open = lastData.close;
            const close = lastData.close + change;
            const high = Math.max(open, close) + Math.abs(change) * Math.random();
            const low = Math.min(open, close) - Math.abs(change) * Math.random();
            
            const newCandle = {
                time: time,
                open: open,
                high: high,
                low: low,
                close: close,
            };
            
            initialData.push(newCandle);
            candleSeries.update(newCandle);
            
            // 更新SMA
            if (initialData.length >= 20) {
                const newSmaData = calculateSMA(initialData, 20);
                smaSeries.setData(newSmaData);
            }
            
            // 更新最后更新时间
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
        }

        // 重置图表函数
        function resetChart() {
            const newData = generateSampleData();
            initialData.length = 0;
            initialData.push(...newData);
            candleSeries.setData(newData);
            
            const newSmaData = calculateSMA(newData, 20);
            smaSeries.setData(newSmaData);
            
            document.getElementById('lastUpdate').textContent = '刚刚';
        }

        // 响应式调整
        window.addEventListener('resize', () => {
            chart.applyOptions({
                width: document.getElementById('chart').clientWidth,
            });
        });

        // 初始更新时间
        document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();

        console.log('K线图表初始化完成！');
    </script>
</body>
</html>
